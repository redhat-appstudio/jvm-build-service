schema_version: 1
version: "SNAPSHOT"
name: "quay.io/QUAY_REPO/hacbs-jdk8-builder"
from: "registry.access.redhat.com/ubi8/openjdk-8"

labels:
- name: "io.openshift.expose-services"
  value: "8080:http"
- name: "io.k8s.description"
  value: "HACBS builder image for building Java components."
- name: "io.k8s.display-name"
  value: "HACBS BuilderImage"
- name: "io.openshift.tags"
  value: "builder,java,hacbs"
- name: "maintainer"
  value: "Stuart Douglas <sdouglas@redhat.com>"

ports:
- value: 8080

modules:
  repositories:
  - path: modules
  install:
  - name: add-hacbs-user
  - name: add-project-dir
  - name: tooling-packages
  - name: glibc-langpack-en
  - name: encoding
  - name: maven-binary
    version: "3.8.4"
  - name: gradle-binary
    version: "7.3"

packages:
  manager: microdnf
  install:
  - buildah
  - findutils
  - podman
  - bzip2-devel
  - gcc-c++
  - libcurl-devel
  - openssl-devel
  - bc
  - which
  - lsof
  - unzip
  - git
  - libstdc++-static
  - glibc-static
  - make
  - autoconf
  - automake
  - libtool
  - tar
  - glibc-devel
  - libgcc.i686
  - glibc-devel.i686

envs:
- name: "PATH"
  value: "$PATH:$JAVA_HOME/bin"
- name: "HOME"
  value: "/home/hacbs"
- name: "NSS_WRAPPER_PASSWD"
  value: "/etc/passwd"
run:
  user: hacbs
  workdir: "/project"
  cmd:
  - "mvn"
  - "-v"
